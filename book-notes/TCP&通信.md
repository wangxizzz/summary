# 长链接VS短链接
## 概念
TCP协议中有长连接和短连接之分。短连接在数据包发送完成后就会自己断开，长连接在发包完毕后，会在一定的时间内保持连接，即我们通常所说的Keepalive（存活定时器）功能。

默认的Keepalive超时需要7,200,000 milliseconds，即2小时，探测次数为5次。它的功效和用户自己实现的心跳机制是一样的。开启Keepalive功能需要消耗额外的宽带和流量，尽管这微不足道，但在按流量计费的环境下增加了费用，另一方面，Keepalive设置不合理时可能会因为短暂的网络波动而断开健康的TCP连接。

设置HTTP长连接：
- Connection:keep-alive.表示长连接。并且每次的响应都需要带上这个字段的值，否则的话，客户端就认为服务器不支持长连接，就会关闭连接。```HTTP1.0的说法。```，**在HTTP1.1默认就是长连接，除非特殊指明。把Connection设置为close.**
- Keep-Alive: 设置长连接的属性(当然只有Connection:keep-alive才会生效)。
    - timeout=120,max=5.前者是长连接持续的最大时间(非承诺值),后者是服务端保持长连接的最大数(非承诺值)。

## 应用场景
### 长连接
1、链接固定且频繁  
长连接多用于操作频繁，点对点的通讯，而且连接数不能太多情况。每个TCP连接都需要三步握手，这需要时间，如果每个操作都是先连接，再操作的话那么处理速度会降低很多，所以每个操作完后都不断开，每次处理时直接发送数据包就OK了，不用建立TCP连接。例如：数据库的连接用长连接， 如果用短连接频繁的通信会造成socket错误，而且频繁的socket 创建也是对资源的浪费。

2、推送业务

### 短连接
1、随机访问的业务  
而像WEB网站的http服务一般都用短链接，因为长连接对于服务端来说会耗费一定的资源，而像WEB网站这么频繁的成千上万甚至上亿客户端的连接用短连接会更省一些资源，如果用长连接，而且同时有成千上万的用户，如果每个用户都占用一个连接的话，资源占用太大。所以并发量大，但每个用户无需频繁操作情况下需用短连好。

